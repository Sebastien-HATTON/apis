define("apis/inherits",[],function(){var e=function(e,t){var n=function(){};n.prototype=t.prototype,e.super_=t,e.prototype=new n,e.prototype.constructor=e};return e}),define("apis/error_base",["./inherits"],function(e){var t=function(){};t.prototype.toString=function(){return""};var n=function(){Error.call(this),this.stackKeeper=this.createStackKeeper()};return e(n,Error),n.prototype.name="ErrorBase",n.prototype.createStackKeeper=function(){var e;return Error.captureStackTrace?(e=new t,Error.captureStackTrace(e,this.constructor)):e=new Error,e},n.prototype.toString=function(){var e=this.name,t=this.getMessage();return t&&(e=[e,t].join(": ")),e},n.prototype.getMessage=function(){return null},n.prototype.getStackTrace=function(){return this.toString()+this.stackKeeper.stack},Object.defineProperties!=null&&Object.defineProperties(n.prototype,{stack:{get:function(){return this.getStackTrace()}},message:{get:function(){return this.getMessage()}}}),n.StackKeeper=n,n}),define("apis/errors",["./inherits","./error_base"],function(e,t){var n=function(e){t.call(this),this.response=e,this.status=e.status;var n=e.data||{};this._message=n.message,this.status=e.status,this.code=n.code};e(n,t),n.prototype.name="WebError",n.prototype.getMessage=function(){return this._message};var r=function(){t.call(this)};return e(r,t),r.prototype.name="NetworkError",{WebError:n,NetworkError:r}}),define("apis/http_request",["./errors"],function(e){var t=function(e,t,n,r,i,s,o){this.http=e,this.options=s||{},this.path=t,this.method=n,this.headers=r||{},this.data=i,this.cb=o,this.url=null,this.body=null,this.transport=null};return t.prototype.methodHttpHeaderName="X-Method",t.prototype.authHttpHeaderName="X-Auth",t.prototype.authExpectedHttpHeaderName="X-AuthExpected",t.prototype.authRenewalHttpHeaderName="X-AuthRenewal",t.prototype.authRenewalIssuedHttpHeaderName="X-AuthRenewalIssued",t.prototype.authRenewalMaxAgeHttpHeaderName="X-AuthRenewalMaxAge",t.prototype.headersUrlKey="headers",t.prototype.bodyUrlKey="body",t.prototype.xdomainUrlKey="xdomain",t.prototype.defaultContentType="application/json",t.prototype.send=function(){return this.url=this.createUrl(),this.body=this.createBody(),this.transport=this.createTransport(),this.createCallback(),this.sendInternal(),this},t.prototype.createUrl=function(){var e=this.path;return this.http.baseUri&&(e=this.http.baseUri+this.path),e},t.prototype.createBody=function(){var e;return this.data===undefined?e="":e=JSON.stringify(this.data),e},t.prototype.createTransport=function(){return new XMLHttpRequest},t.prototype.createCallback=function(){var e=this;this.transport.onreadystatechange=function(){e.transport.readyState==4&&(e.transport.onreadystatechange=null,e.isNetworkError()?e.handleNetworkError():e.handleResponse())}},t.prototype.isNetworkError=function(){return!this.transport.status},t.prototype.handleNetworkError=function(){this.cb(new e.NetworkError)},t.prototype.sendInternal=function(){this.method=="get"?this.sendGet():this.sendPost()},t.prototype.sendGet=function(){this.transport.open("GET",this.createGetUrl()),this.setHttpHeaders(),this.transport.send()},t.prototype.createGetUrl=function(){var e=this.createGetUrlParts(),t=this.url;return e.length>0&&(t+="?"+e.join("&")),t},t.prototype.createGetUrlParts=function(e){var t=e||[];return this.body&&t.push(this.bodyUrlKey+"="+encodeURIComponent(this.body)),t},t.prototype.sendPost=function(){var e=this.transport;e.open("POST",this.url),this.setContentTypeHttpHeader(),this.setMethodHttpHeader(),this.setHttpHeaders(),e.send()},t.prototype.setHttpHeaders=function(){var e=this.createHttpHeaders(),t=this.transport;for(var n in e)t.setRequestHeader(n,e[n])},t.prototype.createHttpHeaders=function(){var e=this.headers,t=e.http||{};return delete e.http,e.auth&&(t[this.authHttpHeaderName]=e.auth),e.authExpected&&(t[this.authExpectedHttpHeaderName]=e.authExpected),t},t.prototype.setContentTypeHttpHeader=function(){var e=this.headers.http&&this.headers.http["Content-type"]||this.headers.contentType||this.defaultContentType;this.transport.setRequestHeader("Content-type",e)},t.prototype.setMethodHttpHeader=function(){this.method!="create"&&this.transport.setRequestHeader(this.methodHttpHeaderName,this.method)},t.prototype.handleResponse=function(){var e=this.createResult(),t=this.extractError(e);t!=null?this.cb(t):this.cb(null,e)},t.prototype.createResult=function(){var e={headers:this.getResultHeaders(),data:this.getResultData()},t=this.getResultStatus();t!=null&&(e.status=t);var n=this.getTransportForResult();return n!=null&&(e.transport=n),e},t.prototype.getTransportForResult=function(){return this.transport},t.prototype.getResultStatus=function(){return this.transport.status},t.prototype.getResultHeaders=function(){var e={},t=this.transport.getResponseHeader(this.authRenewalHttpHeaderName);if(t){var n={token:t};e.authRenewal=n;var r=this.transport.getResponseHeader(this.authRenewalIssuedHttpHeaderName);r&&(n.issued=new Date(r));var i=this.transport.getResponseHeader(this.authRenewalMaxAgeHttpHeaderName);i&&(n.maxAge=parseInt(i,10))}return e},t.prototype.getResultData=function(){var e=this.getResultBody();return e?JSON.parse(e):undefined},t.prototype.getResultBody=function(){return this.transport.responseText},t.prototype.extractError=function(t){var n=t.status,r=null;return n!=200&&n!=204&&(r=new e.WebError(t)),r},t}),define("apis/jsonp_request",["./inherits","./http_request","./errors"],function(e,t,n){var r=function(e,n,r,i,s,o,u){t.call(this,e,n,r,i,s,o,u),this.callbacks=this.getCallbacks(),this.scriptEl=null,this.callbackId=null,this.response=null};return e(r,t),r.callbacks=null,r.prototype.callbacksGlobalPath="apis.jsonp.callbacks",r.prototype.xdomainValue="jsonp",r.prototype.jsonpCallbackUrlKey="callback",r.prototype.getCallbacks=function(){if(r.callbacks==null){var e=this.callbacksGlobalPath.split("."),t=window;for(var n=0;n<e.length;n++){var i=e[n],s=t[i]||{};t[i]=s,t=s}r.callbacks=t}return r.callbacks},r.prototype.createTransport=function(){var e=document.createElement("script");e.async=!0;var t=this;return e.onerror=function(e){t.handleScriptErrorEvent(e)},this.scriptEl=e,e},r.prototype.handleScriptErrorEvent=function(e){this.cleanup(),this.cb(new n.NetworkError)},r.prototype.createCallback=function(){var e=this;this.callbackId=this.createCallbackId(),this.callbacks[this.callbackId]=function(t){e.response=t,e.handleResponse()}},r.prototype.createCallbackId=function(){var e="cb"+Date.now(),t=0,n=e;while(n in this.callbacks)n=e+"_"+t++;return n},r.prototype.sendInternal=function(){this.scriptEl.src=this.createGetUrl();var e=document.head||document.getElementsByTagName("head")[0]||document.documentElement,t=e.firstChild;t?e.insertBefore(this.scriptEl,e.firstChild):e.appendChild(this.scriptEl)},r.prototype.createGetUrlParts=function(e){var t=e||[],n=this.headers;return this.method!="get"&&(n=n||{},n.method=this.method),n&&t.push(this.headersUrlKey+"="+encodeURIComponent(JSON.stringify(n))),r.super_.prototype.createGetUrlParts(t),t.push(this.xdomainUrlKey+"="+this.xdomainValue),t.push(this.jsonpCallbackUrlKey+"="+encodeURIComponent(this.createCallbackName())),t},r.prototype.createCallbackName=function(){return this.callbacksGlobalPath+"."+this.callbackId},r.prototype.setHttpHeaders=function(){},r.prototype.handleResponse=function(){this.cleanup(),r.super_.prototype.handleResponse.call(this)},r.prototype.cleanup=function(){this.removeCallback(),this.removeScripEl()},r.prototype.removeCallback=function(){delete this.callbacks[this.callbackId]},r.prototype.removeScripEl=function(){var e=this.scriptEl;e!=null&&e.parentNode&&(e.parentNode.removeChild(e),this.scriptEl=null)},r.prototype.getTransportForResult=function(){return null},r.prototype.getResultStatus=function(){var e=this.getResultHeaders();return e.status},r.prototype.getResultHeaders=function(){return this.response.headers||{}},r.prototype.getResultData=function(){return this.response.data},r}),define("apis/http",["./http_request","./jsonp_request"],function(e,t){var n=function(e){this.baseUri=e};return n.prototype.send=function(e,t,n,r,i,s){var o;if(i==null||i.crossDomain==null)o=this.sendHttp(e,t,n,r,i,s);else switch(i.crossDomain){case"jsonp":o=this.sendJsonp(e,t,n,r,i,s);break;default:throw new Error("Unsupported crossDomain option "+i.crossDomain)}return o},n.prototype.sendHttp=function(t,n,r,i,s,o){return(new e(this,t,n,r,i,s,o)).send()},n.prototype.sendJsonp=function(e,n,r,i,s,o){return(new t(this,e,n,r,i,s,o)).send()},n}),define("apis/socket",[],function(){var e=function(e,t){this.baseUri=e,this.protocols=t,this.onSocketCreated=null,this.onMessage=null,this.customWebSocketClass=null,this.socket=null,this.requestId=0,this.callbacks={}};return e.prototype.prefix="/socket",e.prototype.headerSeparator="\n\n",e.prototype.getWebSocketClass=function(){return this.customWebSocketClass||WebSocket},e.prototype.createSocket=function(){var e=this.prefix;this.baseUri&&(e=this.baseUri+e);var t=this.getWebSocketClass();return new t(e,this.protocols)},e.prototype.connect=function(e){if(this.socket!=null)switch(this.socket.readyState){case 0:e&&this.socket.addEventListener("open",function(){e()});break;case 1:e&&e();break;default:this.socket=null}if(this.socket==null){this.socket=this.createSocket(),this.onSocketCreated&&this.onSocketCreated(this.socket),e&&this.socket.addEventListener("open",function(){e()});var t=this;this.socket.addEventListener("message",function(e){t.handleMessage(e)})}},e.prototype.handleMessage=function(e){var t=this.parse(e.data),n=t.headers!=null?t.headers.requestId:null;if(n!=null){var r=this.callbacks[n];r&&r(t)}else this.onMessage!=null&&this.onMessage(t)},e.prototype.close=function(){this.socket!=null&&this.socket.close()},e.prototype.send=function(e,t,n,r,i,s){var o=this;this.connect(function(){o.sendInternal(e,t,n,r,i,s)})},e.prototype.sendInternal=function(e,t,n,r,i,s){n=n||{},n.method=t,n.path=e;if(s){var o=n.requestId==null?++this.requestId:n.requestId;this.callbacks[o]=s,n.requestId=o}if(r===undefined)r="";else if(r==null||r.constructor!==String)r=JSON.stringify(r);var u=[JSON.stringify(n),r].join(this.headerSeparator);this.socket.send(u)},e.prototype.parse=function(e){var t=e.indexOf(this.headerSeparator),n=e.substring(0,t),r=e.substring(t+this.headerSeparator.length),i=JSON.parse(n),s={headers:i,data:this.parseBody(r)};return i.status!=null&&(s.status=i.status),s},e.prototype.parseBody=function(e){return JSON.parse(e)},e}),define("apis/main",["./inherits","./error_base","./errors","./http","./http_request","./jsonp_request","./socket"],function(e,t,n,r,i,s,o){return{inherits:e,ErrorBase:t,errors:n,Http:r,HttpRequest:i,JsonpRequest:s,Socket:o}}),define("apis",["apis/main"],function(e){return e})