define("apis/inherits",[],function(){var e=function(e,t){var n=function(){};n.prototype=t.prototype,e.super_=t,e.prototype=new n,e.prototype.constructor=e};return e}),define("apis/error_base",["./inherits"],function(e){var t=function(){};t.prototype.toString=function(){return""};var n=function(){Error.call(this),this.stackKeeper=this.createStackKeeper()};return e(n,Error),n.prototype.name="ErrorBase",n.prototype.createStackKeeper=function(){var e=new t;return Error.captureStackTrace(e,this.constructor),e},n.prototype.toString=function(){var e=this.name,t=this.getMessage();return t&&(e=[e,t].join(": ")),e},n.prototype.getMessage=function(){return"Generic error"},n.prototype.getStackTrace=function(){return this.toString()+this.stackKeeper.stack},Object.defineProperties!=null&&Object.defineProperties(n.prototype,{stack:{get:function(){return this.getStackTrace()}},message:{get:function(){return this.getMessage()}}}),n.StackKeeper=n,n}),define("apis/errors",["./inherits","./error_base"],function(e,t){var n=function(e){t.call(this),this.status=e.status,this.transport=e.transport,this.haders=e.headers,this.data=e.data};return e(n,t),{WebError:n}}),define("apis/http_request",["./errors"],function(e){var t=function(e,t,n,r,i,s,o){this.http=e,this.options=s||{},this.path=t,this.method=n,this.headers=r||{},this.data=i,this.cb=o,this.url=null,this.body=null,this.engine=null};return t.prototype.methodHeaderName="X-Method",t.prototype.headersUrlKey="headers",t.prototype.bodyUrlKey="body",t.prototype.xdomainUrlKey="xdomain",t.prototype.canUseHttpHeaders=!0,t.prototype.send=function(){return this.url=this.createUrl(),this.httpHeaders=this.createHttpHeaders(),this.body=this.createBody(),this.engine=this.createEngine(),this.createCallback(),this.sendInternal(),this},t.prototype.createUrl=function(){var e=this.path;return this.http.baseUri&&(e=this.http.baseUri+this.path),e},t.prototype.createHttpHeaders=function(){var e=null;if(this.canUseHttpHeaders){var t=this.headers;e=t.http||{},delete t.http,t.auth&&(e["X-Auth"]=t.auth),t.authExpected&&(e["X-AuthExpected"]=t.authExpected)}return e},t.prototype.createBody=function(){var e;return this.data===undefined?e="":e=JSON.stringify(this.data),e},t.prototype.createEngine=function(){return new XMLHttpRequest},t.prototype.createCallback=function(){var e=this;this.engine.onreadystatechange=function(){e.engine.readyState==4&&(e.engine.onreadystatechange=null,e.handleResponse())}},t.prototype.sendInternal=function(){this.method=="get"?this.sendGet():this.sendPost()},t.prototype.sendGet=function(){this.engine.open("GET",this.createGetUrl()),this.setHttpHeaders(),this.engine.send()},t.prototype.createGetUrl=function(){var e=this.createGetUrlParts(),t=this.url;return e.length>0&&(t+="?"+e.join("&")),t},t.prototype.createGetUrlParts=function(e){var t=e||[];if(!this.canUseHttpHeaders){var n=this.headers;this.method!="get"&&(n=n||{},n.method=this.method),n&&t.push(this.headersUrlKey+"="+encodeURIComponent(JSON.stringify(n)))}return this.body&&t.push(this.bodyUrlKey+"="+encodeURIComponent(this.body)),t},t.prototype.sendPost=function(){var e=this.engine;e.open("POST",this.url),this.setContentTypeHeader(),this.setMethodHeader(),this.setHttpHeaders(),e.send()},t.prototype.setHttpHeaders=function(){if(this.canUseHttpHeaders){var e=this.httpHeaders;if(e!=null){var t=this.engine;for(var n in e)t.setRequestHeader(n,e[n])}}},t.prototype.setContentTypeHeader=function(){this.engine.setRequestHeader("Content-type",this.headers.contentType||"application/json")},t.prototype.setMethodHeader=function(){this.method!="create"&&this.engine.setRequestHeader(this.methodHeaderName,this.method)},t.prototype.handleResponse=function(){var e=this.createResult(),t=this.extractError(e);t!=null?this.cb(t):this.cb(null,e)},t.prototype.createResult=function(){return{transport:this.engine,status:this.engine.status,headers:this.extractHeaders(),data:this.extractData()}},t.prototype.extractHeaders=function(){var e={},t=this.engine.getResponseHeader("X-AuthRenewal");if(t){var n={token:t};e.authRenewal=n;var r=this.engine.getResponseHeader("X-AuthRenewalIssued");r&&(n.issued=new Date(r));var i=this.engine.getResponseHeader("X-AuthRenewalMaxAge");i&&(n.maxAge=parseInt(i,10))}return e},t.prototype.extractData=function(){return JSON.parse(this.engine.responseText)},t.prototype.extractError=function(t){var n=t.status,r=null;return n!=200&&n!=204&&(r=new e.WebError(t)),r},t}),define("apis/jsonp_request",["./inherits","./http_request"],function(e,t){var n=function(e,n,r,i,s,o,u){t.call(this,e,n,r,i,s,o,u),this.callbacks=this.getCallbacks(),this.scriptEl=null,this.callbackId=null};return e(n,t),n.prototype.callbacksGlobalPath="apis.jsonp.callbacks",n.prototype.xdomainValue="jsonp",n.prototype.jsonpCallbackUrlKey="callback",n.prototype.getCallbacks=function(){var e=this.callbacksGlobalPath.split("."),t=window;for(var n=0;n<e.length;n++){var r=e[n],i=t[r]||{};t[r]=i,t=i}return t},n.prototype.createEngine=function(){var e=document.createElement("script");return e.async=!0,this.scriptEl=e,e},n.prototype.createCallback=function(){var e=this;this.callbackId=this.createCallbackId(),this.callbacks[this.callbackId]=function(t){e.handleResponse(t)}},n.prototype.createCallbackId=function(){var e="cb"+Date.now(),t=0,n=e;while(n in this.callbacks)n=e+"_"+t++;return n},n.prototype.sendInternal=function(){this.scriptEl.src=this.createGetUrl();var e=document.head||document.getElementsByTagName("head")[0]||document.documentElement,t=e.firstChild;t?e.insertBefore(this.scriptEl,e.firstChild):e.appendChild(this.scriptEl)},n.prototype.createGetUrlParts=function(e){var t=n.super_.prototype.createGetUrlParts(e);return t.push(this.xdomainUrlKey+"="+this.xdomainValue),t.push(this.jsonpCallbackUrlKey+"="+encodeURIComponent(this.createCallbackName())),t},n.prototype.createCallbackName=function(){return this.callbacksGlobalPath+"."+this.callbackId},n.prototype.handleResponse=function(e){this.cleanup(),e.headers.status!=null&&(e.status=e.headers.status),this.cb(null,e)},n.prototype.cleanup=function(){this.removeCallback(),this.removeScripEl()},n.prototype.removeCallback=function(){delete this.callbacks[this.callbackId]},n.prototype.removeScripEl=function(){var e=this.scriptEl;e.parentNode&&e.parentNode.removeChild(e)},n}),define("apis/http",["./http_request","./jsonp_request"],function(e,t){var n=function(e){this.baseUri=e};return n.prototype.send=function(e,t,n,r,i,s){var o;if(i==null||i.crossDomain==null)o=this.sendHttp(e,t,n,r,i,s);else switch(i.crossDomain){case"jsonp":o=this.sendJsonp(e,t,n,r,i,s);break;default:throw new Error("Unsupported crossDomain option "+i.crossDomain)}return o},n.prototype.sendHttp=function(t,n,r,i,s,o){return(new e(this,t,n,r,i,s,o)).send()},n.prototype.sendJsonp=function(e,n,r,i,s,o){return(new t(this,e,n,r,i,s,o)).send()},n}),define("apis/socket",[],function(){var e=function(e,t){this.baseUri=e,this.protocols=t,this.onSocketCreated=null,this.onMessage=null,this.customWebSocketClass=null,this.socket=null,this.requestId=0,this.callbacks={}};return e.prototype.prefix="/socket",e.prototype.headerSeparator="\n\n",e.prototype.getWebSocketClass=function(){return this.customWebSocketClass||WebSocket},e.prototype.createSocket=function(){var e=this.prefix;this.baseUri&&(e=this.baseUri+e);var t=this.getWebSocketClass();return new t(e,this.protocols)},e.prototype.connect=function(e){if(this.socket!=null)switch(this.socket.readyState){case 0:e&&this.socket.addEventListener("open",function(){e()});break;case 1:e&&e();break;default:this.socket=null}if(this.socket==null){this.socket=this.createSocket(),this.onSocketCreated&&this.onSocketCreated(this.socket),e&&this.socket.addEventListener("open",function(){e()});var t=this;this.socket.addEventListener("message",function(e){t.handleMessage(e)})}},e.prototype.handleMessage=function(e){var t=this.parse(e.data),n=t.headers!=null?t.headers.requestId:null;if(n!=null){var r=this.callbacks[n];r&&r(t)}else this.onMessage!=null&&this.onMessage(t)},e.prototype.close=function(){this.socket!=null&&this.socket.close()},e.prototype.send=function(e,t,n,r,i,s){var o=this;this.connect(function(){o.sendInternal(e,t,n,r,i,s)})},e.prototype.sendInternal=function(e,t,n,r,i,s){n=n||{},n.method=t,n.path=e;if(s){var o=n.requestId==null?++this.requestId:n.requestId;this.callbacks[o]=s,n.requestId=o}if(r===undefined)r="";else if(r==null||r.constructor!==String)r=JSON.stringify(r);var u=[JSON.stringify(n),r].join(this.headerSeparator);this.socket.send(u)},e.prototype.parse=function(e){var t=e.indexOf(this.headerSeparator),n=e.substring(0,t),r=e.substring(t+this.headerSeparator.length),i=JSON.parse(n),s={headers:i,data:this.parseBody(r)};return i.status!=null&&(s.status=i.status),s},e.prototype.parseBody=function(e){return JSON.parse(e)},e}),define("apis/main",["./inherits","./error_base","./errors","./http","./http_request","./jsonp_request","./socket"],function(e,t,n,r,i,s,o){return{inherits:e,ErrorBase:t,errors:n,Http:r,HttpRequest:i,JsonpRequest:s,Socket:o}}),define("apis",["apis/main"],function(e){return e})